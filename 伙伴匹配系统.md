# 伙伴匹配系统

## 需求分析

1. 用户去添加标签，标签的分类（要有哪些标签、怎么把标签进行分类）
2. 主动搜索：允许用户根据标签去搜索其他用户（Redis 缓存）
3. 组队
   1. 创建队伍
   2. 加入队伍
   3. 根据标签查询队伍
   4. 邀请其他人
4. 允许用户去修改标签
5. 推荐（相似度计算算法 + 本地分布式计算）

## 技术栈

前端：

	1. Vue3 开发框架（提高页面开发的效率）
	1. Vant UI（基于 Vue 的移动端组件库）（React 版 Zent）
	1. Vite（打包工具，快！）
	1. Nginx 来单机部署

后端：

	1. Java + SpringBoot
	1. SpringMVC + MyBatis + MyBatis-Plus
	1. MySQL 数据库
	1. Redis 缓存
	1. Swagger + Knife4j 接口文档

## 前端初始化

### 一、前端项目初始化

> 用脚手架初始化项目
>
> - Vue CLI
> - Vite 脚手架

#### 1. 使用脚手架初始化项目

1. 先看一下 Vite 的官网

![image-20230330085150712](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330085150712.png)

2. 搭建第一个 Vite 项目

![image-20230330085245637](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330085245637.png)

3. 新建一个文件夹，进入后调出 cmd

![image-20230330085501597](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330085501597.png)

4. 使用 npm 命令初始化项目

初始化时要输入项目名（matchup-frontend）、选择脚手架的类型（vue）、前端的类型（TS），都选择好项目就初始化完成了，这个速度还是很快的，比起 Ant Design Pro 块了不止一倍...

![image-20230330090248006](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330090248006.png)

![image-20230330090509447](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330090509447.png)

5. 在 webstorm 中打开项目

![image-20230330090613334](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330090613334.png)

#### 2. 解读一下 `package.json` 中的命令

| package.json                                                 | 是前端项目包管理器的一个依赖文件，在这里，你可以配置项目需要执行的脚本 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20230330091419913](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330091419913.png) | dev 在本地开发环境去启动一个可以实时更新的项目               |
| ![image-20230330091433593](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330091433593.png) | build 就是对项目进行打包，这个 build 命令相当于先执行了 vue-tsc 将 type script 转换成 javascript 然后再执行 vite build |
| ![image-20230330091453997](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330091453997.png) | 其实这个 script 后面的内容你可以随便写，然后随便改成自己的命令 |
| ![image-20230330091506371](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330091506371.png) | preview 可以让你在本地去运行一个预发布环境，提前去浏览这个项目正式上线前是什么样子和 dev 还是有区别的，这个更倾向于线上，它的项目体积可能会更小，删掉一些无用的东西之类的 |
| ![image-20230330091521501](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330091521501.png)![image-20230330091534824](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330091534824.png) | vitejs/plugin-vue 默认安装 vitejs/plugin-vue，vite 是一个构建工具，vite 不需要 vue 和 react 的绑定，这里除了安装 vite 还安装 plugin-vue，这就是一个非常好的设计，它的构建工具是独立于任何的框架，针对每个框架去提供了一个额外的适配，通过一个插件化的方式，然后可以让整个框架，让整个 vite 构建工具的通用性变的更强 |
| ![image-20230330093835921](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330093835921.png) | 这些东西都是放在 devDependencies，就是说这个项目上线的时候，这些依赖就用不到了，这些依赖只在我们开发阶段要把项目打包成包的时候需要用到 |

#### 3. 下载依赖，启动项目

1. `npm install` 下载安装依赖

![image-20230330094323164](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330094323164.png)

依赖安装好后，会多出一个 `node_modules` 文件，这个是整个项目依赖的一些包

2. 启动项目

![image-20230330094430042](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330094430042.png)

启动成功

![image-20230330094443409](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330094443409.png)

访问一下页面

![image-20230330094513520](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330094513520.png)

#### 4. 整合组件库

1. 官方文档的介绍

![image-20230330095112026](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230330095112026.png)

2. 按需引入

```shell
npm i unplugin-vue-components -D
```

> 按需引入的一个好处，这个这个组件库有很多组件，但是大部分我们并用不到，就没必要把它们全都引入到项目中，只需要按需引入就可以了，这样就精简了项目的体积

3. 在终端中输入对应的命令

![image-20230331081810865](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331081810865.png)

4. 配置插件

1. 安装成功后，去根据官方文档配置一下插件

![image-20230331081952085](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331081952085.png)

```tsx
import vue from '@vitejs/plugin-vue';
import Components from 'unplugin-vue-components/vite';
import { VantResolver } from 'unplugin-vue-components/resolvers';

export default {
  plugins: [
    vue(),
    Components({
      resolvers: [VantResolver()],
    }),
  ],
};

```

2. 找到 `vite.config.js` 文件，把代码复制进去

![image-20230331082447260](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331082447260.png)

3. 先安装 vant

![image-20230331082551827](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331082551827.png)

```shell
npm i vant
```

![image-20230331082801182](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331082801182.png)

4. 根据文档提示，引入组件

![image-20230331082842248](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331082842248.png)

```tsx
import { createApp } from 'vue';
// 1. 引入你需要的组件
import { Button } from 'vant';
// 2. 引入组件样式
import 'vant/lib/index.css';

const app = createApp();

// 3. 注册你需要的组件
app.use(Button);
```

5. 我们找到 vue 的主文件（主页面入口），找到 `main.ts`

> `main.ts` 就是前端项目的入口。看他做了什么事情，从 vue 中引入一个 createApp 来创建一个 App 的组件，然后用 mount 将 vue 的页面和我们的 domin 元素关联起来。
>
> 这个 mount 我们将它叫做挂载，就是把一个组件页面挂载到某个页面上，可以理解为：你有一面墙（墙=html），还有一个墙贴（墙贴=app.vue），我们要把**墙贴**贴到**墙**上的某个部分，`index.html`这里有个 id 的 app，然后就和这个关联到了，#app 这个井号就是来指定 ID 的。

![image-20230331083255672](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331083255672.png)

![image-20230331083428623](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331083428623.png)

6. 将刚刚的组件配置文件复制到 `main.ts` 文件中

![image-20230331083756090](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331083756090.png)

#### 5. 测试一下 vant 语法

1. 选择一个 Button 基础组件，复制一下

![image-20230331083914706](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331083914706.png)

```vue
<van-button type="primary">主要按钮</van-button>
<van-button type="success">成功按钮</van-button>
<van-button type="default">默认按钮</van-button>
<van-button type="warning">警告按钮</van-button>
<van-button type="danger">危险按钮</van-button>
```

2. 粘贴到 `App.vue` 中

![image-20230331084235362](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331084235362.png)

3. 再次启动项目，访问一下

![image-20230331084211454](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331084211454.png)

### 二、前端主页 + 组件概览

F12 或者鼠标右键检查，这里可以参考手机和 ipad 适应布局显示，去想象对应页面相应的修改和调整

![image-20230331084520590](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331084520590.png)

![image-20230331084550226](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331084550226.png)

#### 1. 需要做的设计

导航条：展示当前页面名称

主页搜索框 => 搜索页 => 搜索结果页（标签筛选页）

内容：

- 主页（推广页 + 广告）ps：如果你要做商业性的网页，一定要考虑清楚，广告的位置
  - 搜索框
  - banner
  - 最简信息流
- 队伍页
- 用户页（消息 - 暂时考虑发邮件）

#### 2. 前端开发

1. 精简一下老页面

![image-20230331085031520](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331085031520.png)

2. `HelloWorld.vue` 组件

`HelloWorld.vue` 组件的目的是给不是很熟悉 vue 语法的用户提供一个参考

![image-20230331085159045](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331085159045.png)

3. 新建一个目录

在 `src` 目录下面新建一个 `layouts` 目录

很多页面要复用组件 / 样式，重复写很麻烦、不利于维护，所以抽象一个通用的布局（Layout）**一个很重要的设计**

在 `layouts` 目录下新建一个 `BasicLayout.vue`（基础的布局）

![image-20230331085540375](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331085540375.png)

在 `BasicLayout.vue` 写下一些所有页面都要用到的东西

4. 去文档找一下导航条的样式

![image-20230331085822043](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331085822043.png)

![image-20230331085840096](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331085840096.png)

```vue
<van-nav-bar
  title="标题"
  left-text="返回"
  right-text="按钮"
  left-arrow
  @click-left="onClickLeft"
  @click-right="onClickRight"
/>

import { showToast } from 'vant';

export default {
  setup() {
    const onClickLeft = () => history.back();
    const onClickRight = () => showToast('按钮');
    return {
      onClickLeft,
      onClickRight,
    };
  },
};

<van-nav-bar title="标题" left-text="返回" left-arrow>
  <template #right>
    <van-icon name="search" size="18" />
  </template>
</van-nav-bar>
```

5. 在使用之前还要引入导航栏（NavBar）和图标（Icon），不然 vant 不认识它，在 `mian` 引入它

![image-20230331090202797](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331090202797.png)

6. 将上面的导航栏代码粘贴到 `BasicLayout.vue` 并修改一下，到 `App.vue` 引入一下

![image-20230331092444036](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331092444036.png)

![image-20230331091924717](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331091924717.png)

7. 查看一下页面

点击返回时左，点击按钮是右

![image-20230331093234577](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331093234577.png)

![image-20230331093238280](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331093238280.png)

8. 如法炮制，再引入底部的 tabbar，选个功能多一点的

![image-20230331093421995](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331093421995.png)

```vue
<van-tabbar v-model="active" @change="onChange">
  <van-tabbar-item icon="home-o">标签 1</van-tabbar-item>
  <van-tabbar-item icon="search">标签 2</van-tabbar-item>
  <van-tabbar-item icon="friends-o">标签 3</van-tabbar-item>
  <van-tabbar-item icon="setting-o">标签 4</van-tabbar-item>
</van-tabbar>
```

```tsx
import { ref } from 'vue';
import { showToast } from 'vant';

export default {
  setup() {
    const active = ref(0);
    const onChange = (index) => showToast(`标签 ${index}`);
    return {
      icon,
      onChange,
    };
  },
};
```

```tsx
app.use(Tabbar)
app.use(TabbarItem)
```

![image-20230331093601551](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331093601551.png)

![image-20230331094017762](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331094017762.png)

9. 刷新一下页面

![image-20230331094100497](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331094100497.png)

10. 但是鼠标放在下面的图标上一个都没有亮

> 这里我们给 tabbar 标签栏组件中指定了一个 active，这个 active 就是用来表示当前应该高亮哪个 tab，当前用户的位置属于哪个 tab 下。

![image-20230331094322493](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331094322493.png)

这个 active 默认值是 0，改为 index（主页的 name 属性，或者说主页的名字），没有点击主页，主页的图标就高亮了

![image-20230331094545971](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331094545971.png)

> 其实就是通过这个 active 去关联了每个标签上的内容，当你点击某个 tab 时，就会触发切换事件，并且更改这个 active 当前激活的 tab 值。

这里使用了 change 事件，就是当用户切换这个 tab 栏时，会触发 Toast（也是 vant 的组件），触发一个比较轻量的提示

![image-20230331101948837](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331101948837.png)

11. 分别点击三个图标

![image-20230331102011947](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102011947.png)

![image-20230331102020718](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102020718.png)

![image-20230331102029330](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102029330.png)

12. 现在给中间添加一些内容

![image-20230331102207666](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102207666.png)

![image-20230331102322711](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102322711.png)

13. 再去创建一个页面，在 src 目录下新建 pages 目录

![image-20230331102417146](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102417146.png)

14. 然后在 pages 目录下新建两个页面 `Index.vue` 和 `Team.vue`

![image-20230331102526754](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331102526754.png)

15. 当我们点击这个 tab 栏时，然后就去加载对应的页面

![image-20230331103034743](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331103034743.png)

![image-20230331103530916](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331103530916.png)

## 数据库表设计

> 标签的分类（要有哪些标签，怎么把标签进行分类）

### 一、新增标签表（分类表）

> 建议用标签，不要用分类，更灵活

#### 1. 想一想，需要哪些标签分类？

1. 性别：男、女
2. 方向：Java、C++、Py、Go、前端
3. 正在学：Spring
4. 目标：考研、春招、秋招、校招、社招、考公、竞赛（蓝桥杯）、转行、跳槽
5. 段位：初级、中级、高级、王者
6. 身份：小学、初中、高中、大一、大二、大三、大四、学生、待业、已就业、研一、研二、研三
7. 状态：乐观、有点丧、一般、单身、已婚、有对象

或者：【用户自己定义标签】

#### 2. 表设计

| 标签表（分类表） |                                                              |                                   |
| ---------------- | ------------------------------------------------------------ | --------------------------------- |
| 字段             | 说明                                                         | 类型                              |
| id               | 主键                                                         | bigint                            |
| tagName          | 标签名（非空；必须唯一、唯一索引）                           | varchar                           |
| userId           | 上传标签的用户（如果要根据 userId 查已上传标签的话，最好加上，普通索引） | bigint                            |
| parentId         | 父标签id（分类）                                             | bigint                            |
| isParent         | 是否为父标签                                                 | tingint（0-不是父标签、1-父标签） |
| createTime       | 创建时间                                                     | datetime                          |
| updateTime       | 更新时间                                                     | dateTime                          |
| isDelete         | 是否删除（逻辑删除）                                         | tinyint（0、1）                   |

> 怎么查询所有标签，并且把标签分好组？按父标签 id 分组，能实现 √
>
> 根据父标签查询子标签？根据 id 查询，能实现 √

> **小知识**
>
> SQL 语言分类：
>
> 1. DDL define 建表、操作表
> 2. DML manage 更新删除数据，影响实际表里的内容
> 3. DCL control 控制、权限
> 4. DQL query 查询，select
>
> 附加：[DQL、DML、DDL、DCL的概念与区别 - 范兵 - 博客园 (cnblogs.com)](https://www.cnblogs.com/fan-yuan/p/7879353.html)

在数据库中建立 tag 表

```mysql
-- auto-generated definition
create table tag
(
    id           bigint auto_increment comment 'id' primary key,
    tagName      varchar(256)                       null comment '标签名称',
    userId       bigint                             null comment '用户 id',
    parentId     bigint                             null comment '父标签 id',
    isParent     tinyint                            null comment '0-不是, 1-父标签',
    creatTime    datetime default CURRENT_TIMESTAMP null comment '创建时间',
    updateTime   datetime default CURRENT_TIMESTAMP null on update CURRENT_TIMESTAMP comment '更新时间',
    isDelete     tinyint  default 0                 not null comment '是否删除'
)
    comment '标签表' auto_increment = 8;
```

![image-20230331110628133](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331110628133.png)

### 二、修改用户表

> 修改用户表，就要知道用户有哪些标签

**方式一：**

直接在用户表补充 tags 字段，[ ‘Java’, ‘男’ ] 存 json 字符串

**优点**：查询方便、不用新建关联表，标签是用户的固有属性

（除了该系统、其他系统可能要用到，标签是用户的固有属性）节省开发成本

**应用场景**：查询用户列表，查关系表拿到这 100 个用户的所有标签 id，再根据标签 id 去查标签表

**缺点**：用户表多一列，会降低性能



**方式二：**

加一个关联表，记录用户和标签的关系

**关联表的应用场景**：查询灵活，可以正查反查

**缺点**：要多建一个表、多维护一个表

**重点**：企业大项目开发中尽量减少关联查询，很难影响扩展性，而且会影响查询性能



我们采用第一种方法

```mysql
alter table user add COLUMN tags varchar(1024) null comment '标签列表';
```

![image-20230331115052790](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331115052790.png)

之后可能要经常通过这个标签名去搜索，给标签名加上一个唯一索引，上传标签的用户加上普通索引

![image-20230331115504918](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331115504918.png)

![image-20230331115643814](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331115643814.png)

可以看到多了两个索引

![image-20230331115724461](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331115724461.png)

将刚刚写的添加字段和新建 tag 表语句，添加到 `create_table.sql` 中

![image-20230331223622883](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230331223622883.png)

## 开发后端

### 一、开发后端接口设计

**搜索标签的两种方式**

#### 1. SQL 查询

> 实现简单，可以通过拆分查询进一步优化

1. 允许用户传入多个标签，多个标签都存在才搜索的出来 and。like ‘%Java%’ and like ‘%C++%’ 。
2. 允许用户传入多个标签，有任何一个标签存在就能搜索出来 or。like ‘%Java%’ or like ‘%C++%’ 。

#### 2. 内存查询

（灵活，可以通过并发进一步优化）

**思路**：

- 如果参数可以分析，根据用户的参数去选择查询方式，比如标签数
- 如果参数不可以分析，并且数据库连接足够、内存空间足够，可以并发同时查询，谁先返回用谁
- 还可以 SQL 查询与内存计算相结合，比如先用 SQL 过掉部分 tag

### 二、初始化后端

> 用户中心来集中提供用户的检索、操作、注册、登录、鉴权

#### 1. 编写用户标签搜索方法

1. 我们已经有了一个用户中心，直接在用户中心的基础上写

![image-20230401132125845](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401132125845.png)

2. 在 UserServiceImpl 中写下搜索用户的接口，再打上注释输入 /**

![image-20230401132721296](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401132721296.png)

```java
    /**
     * 根据标签搜索用户
     * @param tagNameList 用户要拥有的标签
     * @return
     */
    @Override
    public int searchUsersByTags(List<String> tagNameList) {

    }
```

3. 在 UserService 中也给这个方法打上注释

![image-20230401133437572](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401133437572.png)

```java
    /**
     * 根据标签搜索用户
     * @param tagNameList 用户拥有的标签
     * @return
     */
    int searchUsersByTags(List<String> tagNameList);
```

3. 回到 UserServiceImpl 中开始编写逻辑

> 先判断一下是否为空，然后如果说是空的话，直接抛出异常返回；否则的话，创建这个查询，放进一个 queryWrapper = new QueryWrapper，在 queryWrapper 把 tagList 全部组成一个 and 的查询…

![image-20230401135332121](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401135332121.png)

```java
/**
 * 根据标签搜索用户
 * @param tagNameList 用户要拥有的标签
 * @return
 */
@Override
public List<User> searchUsersByTags(List<String> tagNameList) {
    if (CollectionUtils.isEmpty(tagNameList)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    // 拼接 and 查询
    // like '%Java%' and like '%Python%'
    for (String tagName : tagNameList) {
        queryWrapper = queryWrapper.like("tags", tagName);
    }
    List<User> userList = userMapper.selectList(queryWrapper);
    userList.forEach(this::getSafetyUser);
}
```

4. 我们要返回一个新的列表

![image-20230401135928794](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401135928794.png)

```java
return userList.stream().map(this::getSafetyUser).collect(Collectors.toList());
```

#### 2. 测试

1. 编写测试代码

![image-20230401141258481](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401141258481.png)

```java
@Test
void testSearchUsersByTags() {
    List<String> tagNameList = Arrays.asList("java", "python");
    List<User> userList = userService.searchUsersByTags(tagNameList);
    Assert.assertNotNull(userList);
}
```

2. 不过现在搜不到，我们要去数据库修改下数据

![image-20230401141606301](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401141606301.png)

3. 开启 sql 输出日志

![image-20230401141832016](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401141832016.png)

4. 测试一下，看看结果

![image-20230401142616262](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401142616262.png)

5. 因为在数据库中添加了一个 tags 字段，但是在 mybatis-plus 中还没有添加，现在添加一下

![image-20230401142807648](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401142807648.png)

![image-20230401142853930](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401142853930.png)

![image-20230401142932283](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401142932283.png)

6. 替换一下 create.sql 中 user 表的建表语句

![image-20230401143214741](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401143214741.png)

7. 现在换一种查询方式

![image-20230401144039514](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401144039514.png)

```java
    /**
     * 根据标签搜索用户
     * @param tagNameList 用户要拥有的标签
     * @return
     */
    @Override
    public List<User> searchUsersByTags(List<String> tagNameList) {
        if (CollectionUtils.isEmpty(tagNameList)) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
//        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
//        // 拼接 and 查询
//        // like '%Java%' and like '%Python%'
//        for (String tagName : tagNameList) {
//            queryWrapper = queryWrapper.like("tags", tagName);
//        }
//        List<User> userList = userMapper.selectList(queryWrapper);
        // 1.查询所有用户
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        List<User> userList = userMapper.selectList(queryWrapper);
        // 2.在内存中判断是否包含要求的标签
        for (User user : userList) {
            String tagsStr = user.getTags();
        }
        return userList.stream().map(this::getSafetyUser).collect(Collectors.toList());
    }
```

#### 3. 将字符串转为 json

> **解析 JSON 字符串**：
>
> 1. 序列化：java 对象转成 json
> 2. 反序列化：把 json 转为 java 对象
>
> **java json 序列化库有很多**：
>
> 1. gson（goole 的）
> 2. fastjson alibaba（ali 出品，块，但漏洞多）
> 3. jackson
> 4. kryo

1. 去 maven 仓库中搜索 gson，复制依赖

![image-20230401144430014](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401144430014.png)

```xml
<!-- https://mvnrepository.com/artifact/com.google.code.gson/gson -->
<dependency>
    <groupId>com.google.code.gson</groupId>
    <artifactId>gson</artifactId>
    <version>2.8.9</version>
</dependency>
```

2. 放到 pom.xml 文件中，加载依赖

![image-20230401144601596](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401144601596.png)

3. 继续编写 UserServiceImp 方法

![image-20230401145157223](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401145157223.png)

```java
    /**
     * 根据标签搜索用户
     * @param tagNameList 用户要拥有的标签
     * @return
     */
    @Override
    public List<User> searchUsersByTags(List<String> tagNameList) {
        if (CollectionUtils.isEmpty(tagNameList)) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR);
        }
//        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
//        // 拼接 and 查询
//        // like '%Java%' and like '%Python%'
//        for (String tagName : tagNameList) {
//            queryWrapper = queryWrapper.like("tags", tagName);
//        }
//        List<User> userList = userMapper.selectList(queryWrapper);
        // 1.查询所有用户
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        List<User> userList = userMapper.selectList(queryWrapper);
        Gson gson = new Gson();
        // 2.在内存中判断是否包含要求的标签
        return userList.stream().filter(user -> {
            String tagsStr = user.getTags();
            if (StringUtils.isBlank(tagsStr)) {
                return false;
            }
            Set<String> tempTagNameSet = gson.fromJson(tagsStr, new TypeToken<Set<String>>() {
            }.getType());
            for (String tagName : tagNameList) {
                if (!tempTagNameSet.contains(tagName)) {
                    return false;
                }
            }
            return true;
        }).map(this::getSafetyUser).collect(Collectors.toList());
    }
```

4. 测试一下

![image-20230401145344273](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401145344273.png)

**思考？**两种查询的方式哪种更快呢？

> 应该是第二种方式更快，第一种方式是直接用 sql 来进行查询，查询的内容是硬盘上的
>
> 而第二种方式，我们是直接将所有的数据都取出来，在内存中进行查询，显然，内存的速度要远远快于硬盘的速度
>
> 所以，一般来说第二种的速度会更快一点，但是由于当前的数据量比较小，所以测试并不准确，具体的快慢还是要看具体的应用场景

### 三、后端标签接口调试

#### 1. 内存过滤

```java
/**
 * 根据标签搜索用户（内存过滤）
 *
 * @param tagNameList 用户要拥有的标签
 * @return
 */
@Override
public List<User> searchUsersByTags(List<String> tagNameList) {
    if (CollectionUtils.isEmpty(tagNameList)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    // 1.查询所有用户
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    List<User> userList = userMapper.selectList(queryWrapper);
    Gson gson = new Gson();
    // 2.在内存中判断是否包含要求的标签
    return userList.stream().filter(user -> {
        String tagsStr = user.getTags();
        if (StringUtils.isBlank(tagsStr)) {
            return false;
        }
        Set<String> tempTagNameSet = gson.fromJson(tagsStr, new TypeToken<Set<String>>() {
        }.getType());
        tempTagNameSet = Optional.ofNullable(tempTagNameSet).orElse(new HashSet<>());
        for (String tagName : tagNameList) {
            if (!tempTagNameSet.contains(tagName)) {
                return false;
            }
        }
        return true;
    }).map(this::getSafetyUser).collect(Collectors.toList());
}
```

#### 2. SQL查询版

```java
/**
 * 根据标签搜索用户（SQL查询版）
 *
 * @param tagNameList 用户要拥有的标签
 * @return
 */
@Deprecated
public List<User> searchUsersBySql(List<String> tagNameList) {
    if (CollectionUtils.isEmpty(tagNameList)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    // 拼接 and 查询
    // like '%Java%' and like '%Python%'
    for (String tagName : tagNameList) {
        queryWrapper = queryWrapper.like("tags", tagName);
    }
    List<User> userList = userMapper.selectList(queryWrapper);
    return userList.stream().map(this::getSafetyUser).collect(Collectors.toList());
}
```

## 前端开发

### 一、前端整合路由

#### 1. 下载安装vue路由

1. 引入一个路由：[Vue Router | The official Router for Vue.js (vuejs.org)](https://router.vuejs.org/)

![image-20230401231950810](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401231950810.png)

2. 下载安装路由

```shell
# npm
npm install vue-router@4

# yarn
yarn add vue-router@4
```

![image-20230401232313357](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401232313357.png)

3. 再次启动项目，`package.json` 中多了 `vue-router`

![image-20230401232401533](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401232401533.png)

#### 2. 整合路由框架

1. 继续跟着官方文档，看一下怎么引用

![image-20230401232503487](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401232503487.png)

```javascript
// 1. 定义路由组件.
// 也可以从其他文件导入
const Home = { template: '<div>Home</div>' }
const About = { template: '<div>About</div>' }

// 2. 定义一些路由
// 每个路由都需要映射到一个组件。
// 我们后面再讨论嵌套路由。
const routes = [
  { path: '/', component: Home },
  { path: '/about', component: About },
]

// 3. 创建路由实例并传递 `routes` 配置
// 你可以在这里输入更多的配置，但我们在这里
// 暂时保持简单
const router = VueRouter.createRouter({
  // 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。
  history: VueRouter.createWebHashHistory(),
  routes, // `routes: routes` 的缩写
})

// 5. 创建并挂载根实例
const app = Vue.createApp({})
//确保 _use_ 路由实例使
//整个应用支持路由。
app.use(router)

app.mount('#app')

// 现在，应用已经启动了！
```

2. 找到前端项目的主页面，修改一下

![image-20230401232652769](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401232652769.png)

修改后：

![image-20230401233725476](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401233725476.png)

```tsx
import { createApp } from 'vue';
import {Button, Icon, NavBar, Tabbar, TabbarItem } from 'vant';
import App from './App.vue';
import 'vant/es/toast/style';
// @ts-ignore
import * as VueRouter from "vue-router";
import Index from "./pages/Index.vue";
import Team from "./pages/Team.vue";

const app = createApp(App);
app.use(Button);
app.use(Icon);
app.use(NavBar);
app.use(Tabbar)
app.use(TabbarItem)

// 定义一些路由
const routes = [
    { path: '/', component: Index },
    { path: '/about', component: Team },
]

const router = VueRouter.createRouter({
    // 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。
    history: VueRouter.createWebHashHistory(),
    routes, // `routes: routes` 的缩写
})

app.use(router);

app.mount('#app');
```

> 这个页面的跳转的规则，它是一个全局性的东西，所以尽量把它提出，要不然后面可能写起来会非常复杂，不要什么东西都写在主文件里面
>
> ![image-20230401233935618](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401233935618.png)

3. 新建一个配置文件，在 src 目录下创建 config 目录，在 config 目录下创建 `route.ts` 文件

![image-20230401234221320](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401234221320.png)

4. 在 `main.ts` 中引入一下

![image-20230401234325578](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401234325578.png)

5. 找到布局文件 `BasicLayout.vue`，之前我们用 v-if，现在不用了，引入 `route-view`，这个是根据不同的页面展示不同的内容

![image-20230401234633693](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401234633693.png)

改为：

![image-20230401234730220](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401234730220.png)

6. 搭配 `router-link` 来创建链接，试一下

![image-20230401234840837](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401234840837.png)

![image-20230401235011047](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401235011047.png)

7. 测试一下

点击 Go to Home 显示主页面，点击队伍显示队伍，路径也不一样

![image-20230401235056634](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401235056634.png)

#### 3. tab栏切换路由

这说明框架已经整合成功了，我们现在需要用底下这个 tab 栏去切换路由

1. 去看一下 vant3 的官方文档

![image-20230401235356002](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401235356002.png)

```vue
<router-view />

<van-tabbar route>
  <van-tabbar-item replace to="/home" icon="home-o">标签</van-tabbar-item>
  <van-tabbar-item replace to="/search" icon="search">标签</van-tabbar-item>
</van-tabbar>
```

2. 继续修改 `BasicLayout.vue`

![image-20230401235637975](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401235637975.png)

3. 在 `pages` 目录下新建一个个人页 `User.vue`

![image-20230401235832886](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230401235832886.png)

4. 在 `route.ts` 中加上个人页路由

![image-20230402000042473](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402000042473.png)

5. 测试一下

![image-20230402000114165](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402000114165.png)

6. 将 `router-link` 删掉，路由整合就完成了

![image-20230402000211822](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402000211822.png)

### 二、搜索页面

#### 1. 添加一个搜索页面

1. 去看下 vant3 的文档：找一个合适的搜索页面，参考一下 bilibili

![image-20230402102340302](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402102340302.png)

![image-20230402102558451](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402102558451.png)

```html
<form action="/">
  <van-search
    v-model="value"
    show-action
    placeholder="请输入搜索关键词"
    @search="onSearch"
    @cancel="onCancel"
  />
</form>
```

```tsx
import { ref } from 'vue';
import { showToast } from 'vant';

export default {
  setup() {
    const value = ref('');
    const onSearch = (val) => showToast(val);
    const onCancel = () => showToast('取消');
    return {
      value,
      onSearch,
      onCancel,
    };
  },
};
```

2. 新建一个搜索页 `Search.vue`，把代码粘贴过去，修改一下

![image-20230402103037733](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402103037733.png)

```vue
<template>
  <form action="/">
    <van-search
        v-model="searchText"
        show-action
        placeholder="请输入搜索关键词"
        @search="onSearch"
        @cancel="onCancel"
    />
  </form>
</template>

<script setup>
  import { ref } from 'vue';
  import { showToast } from 'vant';
  const searchText = ref('');
  const onSearch = (val) => showToast(val);
  const onCancel = () => showToast('取消');
</script>
```

3. 然后做一个点击搜索按钮，跳转到搜索页面，看一下 vue 官方文档

![image-20230402103426370](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402103426370.png)

```vue
// 字符串路径
router.push('/users/eduardo')
```

4. 到 `BasicLayout.vue` 粘贴过去，修改一下

![image-20230402103647635](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402103647635.png)

5. 挂载一下搜索路由

![image-20230402104007091](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402104007091.png)

6. 点击搜索按钮试一下，会先弹出一个提示框，然后跳转到搜索页面

![image-20230402104313798](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402104313798.png)

![image-20230402105323557](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402105323557.png)

#### 2. 添加标签和分组

1. 但是点击搜索后，我们还想让它展示当前已选择的标签

![image-20230402105622953](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402105622953.png)

```html
<van-tag :show="show" closeable size="medium" type="primary" @close="close">
  标签
</van-tag>
```

```tsx
import { ref } from 'vue';

export default {
  setup() {
    const show = ref(true);
    const close = () => {
      show.value = false;
    };

    return {
      show,
      close,
    };
  },
};
```

2. 还需要一个列表给它分组

![image-20230402105810685](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402105810685.png)

```vue
<van-divider content-position="left">文字</van-divider>
<van-divider content-position="right">文字</van-divider>
```

3. 将文件名字改一下，标准一下

![image-20230402110204375](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402110204375.png)

![image-20230402110711703](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402110711703.png)

4. 将 tag 标签和分割线代码都粘贴到 `SearchPage.vue` 中，修改一下

![image-20230402110847718](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402110847718.png)

5. 试一下，标签出来了（有点丑）

![image-20230402110931844](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402110931844.png)

6. 选择标签就用 `TreeSelect` 分类选择

![image-20230402111340710](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402111340710.png)

```vue
<van-tree-select
  v-model:active-id="activeIds"
  v-model:main-active-index="activeIndex"
  :items="items"
/>
```

```tsx
import { ref } from 'vue';

export default {
  setup() {
    const activeId = ref([1, 2]);
    const activeIndex = ref(0);
    const items = [
      {
        text: '浙江',
        children: [
          { text: '杭州', id: 1 },
          { text: '温州', id: 2 },
          { text: '宁波', id: 3, disabled: true },
        ],
      },
      {
        text: '江苏',
        children: [
          { text: '南京', id: 4 },
          { text: '无锡', id: 5 },
          { text: '徐州', id: 6 },
        ],
      },
      { text: '福建', disabled: true },
    ];

    return {
      items,
      activeId,
      activeIndex,
    };
  },
};
```

7. 粘贴进 `SearchPage.vue`，修改一下

![image-20230402112825916](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402112825916.png)

![image-20230402112842057](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402112842057.png)

8. 测试一下

![image-20230402112911686](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402112911686.png)

9. 现在已选的标签还不能被移除，我们修改一下

![image-20230402113111065](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402113111065.png)

![image-20230402113153095](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402113153095.png)

10. 测试一下

![image-20230402113319838](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402113319838.png)

11. 将标签的 id 改为 text 的文本

![image-20230402113447734](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402113447734.png)

12. 测试一下

![image-20230402113725988](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402113725988.png)

#### 3. 优化一下

1. 已选中标签挤在一起，不美观

![image-20230402113831018](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402113831018.png)

```vue
<van-row gutter="20">
  <van-col span="8">span: 8</van-col>
  <van-col span="8">span: 8</van-col>
  <van-col span="8">span: 8</van-col>
</van-row>
```

2. 粘贴进 `SearchPage.vue`，修改一下

![image-20230402213236560](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402213236560.png)

3. 看一下

![image-20230402213356271](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402213356271.png)

4. 现在还差个过滤标签

> 可以直接在前端里面过滤，因为标签数据量不大，没有必要向后端发送请求

![image-20230402213637390](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402213637390.png)

![image-20230402213723527](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402213723527.png)

> 原来是嵌套结构，这一步其实就是把数组打平，或者叫扁平化

5. 打平之后，再过滤

![image-20230402214153332](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402214153332.png)

![image-20230402221618376](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402221618376.png)

6. 点击搜索试一下

![image-20230402221656559](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402221656559.png)

### 三、用户信息页

1. 去官方文档找一个现成的

![image-20230402222720541](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402222720541.png)

```vue
<van-cell title="单元格" is-link />
<van-cell title="单元格" is-link value="内容" />
<van-cell title="单元格" is-link arrow-direction="down" value="内容" />
```

2. 粘贴进 `UserPage.vue`

> 定义一下后台用户数据的类别，我们现在用的是 ts，它有一个好处是可以定义一下某一个对象它的规范，比如说有哪些字段，字段是什么类型，那这个类型从哪里取？我们是不是以后中心的时候写过这个规范，写过这个类别

```tsx
  type CurrentUser = {
    id?: number;
    username?: string;
    userAccount: string;
    avatarUrl: string;
    gender?: number;
    phone?: string;
    email?: string;
    userStatus?: number;
    userRole?: number;
    planetCode?: string;
    createTime?: Date;
  };
```

3. 在 src 下新建一个 models 目录，在 models 目录下新建 `user.d.ts`，在这里定义我们的数据类型，把代码粘贴进去，修改一下

![image-20230402223818490](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402223818490.png)

```tsx
/**
 * 用户类型
 */
export type UserType = {
    id: number;
    username: string;
    userAccount: string;
    avatarUrl?: string;
    gender: number;
    phone: string;
    email: string;
    userStatus: number;
    userRole: number;
    planetCode: string;
    tags: string[];
    createTime: Date;
};
```

4. 在 `UserPage.vue` 中引入

![image-20230402232308015](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402232308015.png)

```vue
<template>
  <van-cell title="昵称" is-link to="/user/edit" :value="user.username" />
  <van-cell title="账号" :value="user.userAccount" />
  <van-cell title="头像" is-link to="/user/edit">
    <img style="height: 48px" :src="user.avatarUrl" />
  </van-cell>
  <van-cell title="性别" is-link to="/user/edit" :value="user.gender" />
  <van-cell title="电话" is-link to="/user/edit" :value="user.phone" />
  <van-cell title="邮箱" is-link to="/user/edit" :value="user.email" />
  <van-cell title="星球编号" :value="user.planetCode" />
  <van-cell title="注册时间" :value="user.createTime.toISOString()" />
</template>

<script setup>
const user = {
  id: 1,
  username: 'fickle',
  userAccount: 'fickle',
  avatarUrl: 'http://qzapp.qlogo.cn/qzapp/101983660/DE2DFA542010DAD2696FC2082D1EE3E7/100',
  gender: '男',
  phone: '123',
  email: '456@qq.com',
  planetCode: '1234',
  createTime: new Date(),
}
</script>

<style scoped>

</style>
```

5. 测试一下

![image-20230402232348243](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402232348243.png)

6. 现在做编辑信息，编辑就是点击 `>` 进入到编辑页面

![image-20230402232443758](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402232443758.png)

### 四、用户信息修改页

1. 复制 `UserPage.vue`，粘贴到 pages 目录下，重命名为 `UserEditPage.vue`，新建一个编辑用户页

![image-20230402232641681](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402232641681.png)

2. 在 `route.ts` 新增路由

![image-20230402232807409](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402232807409.png)

3. 修改一下 `UserPage.vue` 和 `UserEditPage.vue`

![image-20230402234905690](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402234905690.png)

![image-20230402235124823](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402235124823.png)

4. 试一下

![image-20230402235226117](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402235226117.png)

5. 删掉一些代码，恢复成如图所示

![image-20230402235506741](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402235506741.png)

![image-20230402235414512](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402235414512.png)

6. 去官方文档找一个编辑方法

![image-20230402235643334](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230402235643334.png)

```vue
<van-form @submit="onSubmit">
  <van-cell-group inset>
    <van-field
      v-model="username"
      name="用户名"
      label="用户名"
      placeholder="用户名"
      :rules="[{ required: true, message: '请填写用户名' }]"
    />
    <van-field
      v-model="password"
      type="password"
      name="密码"
      label="密码"
      placeholder="密码"
      :rules="[{ required: true, message: '请填写密码' }]"
    />
  </van-cell-group>
  <div style="margin: 16px;">
    <van-button round block type="primary" native-type="submit">
      提交
    </van-button>
  </div>
</van-form>
```

```tsx
import { ref } from 'vue';

export default {
  setup() {
    const username = ref('');
    const password = ref('');
    const onSubmit = (values) => {
      console.log('submit', values);
    };

    return {
      username,
      password,
      onSubmit,
    };
  },
};
```

7. 粘贴进 `UserEditPage.vue`，修改一下

![image-20230403000414395](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230403000414395.png)

![image-20230403000423505](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230403000423505.png)

8. 再修改一下 `UserPage.vue`

![image-20230403000645213](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230403000645213.png)

9. 再试一下，修改页就出来了，点击提交，数据也传过来了

![image-20230403000806795](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230403000806795.png)

但是点击左上角的返回时，直接回到了主页，修改一下

10. 让它回到上一个页面，将 `router.push('/')`改为`router.back()`

![image-20230403000944051](https://fickler-1314393782.cos.ap-beijing.myqcloud.com/img/image-20230403000944051.png)



测试 github 笔记效果



11212121212

12212121
